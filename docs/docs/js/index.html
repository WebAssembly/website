<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>JavaScript API - WebAssembly 中文网</title>
  <link rel="stylesheet" type="text/css" href="/css/custom.css">
</head>


<body>
  <header class="page-section-spacious">
    <div class="container">
    <div class="site-logo">
      <h1 class="title">WebAssembly 中文网</h1>
    </div>
    <nav class="site-nav">
      <a class="site-nav-item btn" href="/">概述</a>
      <a class="site-nav-item btn" href="/demo/">Demo</a>
      <a class="site-nav-item btn" href="/getting-started/developers-guide/">快速开始</a>
      
      
      <a class="site-nav-item btn" href="/docs/js/">文档</a>
      <a class="site-nav-item btn" href="/community/feedback/">社区</a>
      <a class="site-nav-item btn" href="/roadmap/">路线图</a>
      <a class="site-nav-item btn" href="/docs/faq/">FAQ</a>
    </nav>
    </div>
  </header>
  <section class="banner-update">
    <div class="container">
      <div class="banner-update-icon"></div>
      <span class="banner-update-date"></span>
      <span>多个浏览器已经达成对初始 WebAssembly 版本的一致意见 <a href="/roadmap/">查看更多</a></span>
    </div>
  </section>
  

<section>
  <div class="container">
    <div class="row">
      <div class="col-xs-12 col-lg-9 col-pop">
        <h1 id="javascript-api">JavaScript API</h1>

<p>In the <a href="../mvp/">MVP</a>, the only way to access WebAssembly on the Web is through
an explicit JS API which is defined below.
(In the <a href="../future-features/">future <img class="emoji" title=":unicorn:" alt=":unicorn:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f984.png" height="20" width="20" align="absmiddle"></a>, WebAssembly may also
be loaded and run directly from an HTML <code class="highlighter-rouge">&lt;script type='module'&gt;</code> tag—and
any other Web API that loads ES6 modules via URL—as part of 
<a href="../modules/#integration-with-es6-modules">ES6 Module integration</a>.)</p>

<p>WebAssembly JS API declaration file for TypeScript can be found <a href="https://github.com/01alchemist/webassembly-types/blob/master/webassembly.d.ts">here</a> which enable autocompletion and make TypeScript compiler happy.</p>

<h2 id="traps">Traps</h2>

<p>Whenever WebAssembly semantics specify a <a href="../semantics/#traps">trap</a>,
a <code class="highlighter-rouge">WebAssembly.RuntimeError</code> object is thrown. WebAssembly code (currently)
has no way to catch this exception and thus the exception will necessarily
propagate to the enclosing non-WebAssembly caller (either the browser or
JavaScript) where it is handled like a normal JavaScript exception.</p>

<p>If WebAssembly calls JavaScript via import and the JavaScript throws an
exception, the exception is propagated through the WebAssembly activation to the
enclosing caller.</p>

<p>Because JavaScript exceptions can be handled, and JavaScript can continue to
call WebAssembly exports after a trap has been handled, traps do not, in
general, prevent future execution.</p>

<h2 id="stack-overflow">Stack Overflow</h2>

<p>Whenever a <a href="../semantics/#stack-overflow">stack overflow</a> is happening in
WebAssembly code, the same exception is thrown as for a stack overflow in
JavaScript.</p>

<h2 id="the-webassembly-object">The <code class="highlighter-rouge">WebAssembly</code> object</h2>

<p>The <code class="highlighter-rouge">WebAssembly</code> object is the initial value of the <code class="highlighter-rouge">WebAssembly</code> property of
the global object. Like the <code class="highlighter-rouge">Math</code> and <code class="highlighter-rouge">JSON</code> objects, the <code class="highlighter-rouge">WebAssembly</code> object
is a plain JS object (not a constructor or function) that acts like a namespace
and has the following properties:</p>

<h3 id="webassembly--tostringtag--property">
<code class="highlighter-rouge">WebAssembly [ @@toStringTag ]</code> Property</h3>

<p>The initial value of the <a href="https://tc39.github.io/ecma262/#sec-well-known-symbols"><code class="highlighter-rouge">@@toStringTag</code></a>
property is the String value <code class="highlighter-rouge">"WebAssembly"</code>.</p>

<p>This property has the attributes { [[Writable]]: <code class="highlighter-rouge">false</code>, [[Enumerable]]: <code class="highlighter-rouge">false</code>, [[Configurable]]: <code class="highlighter-rouge">true</code> }.</p>

<h3 id="constructor-properties-of-the-webassembly-object">Constructor Properties of the <code class="highlighter-rouge">WebAssembly</code> object</h3>

<p>The following intrinsic objects are added:</p>

<ul>
  <li>
<code class="highlighter-rouge">WebAssembly.Module</code> : the <a href="#webassemblymodule-constructor"><code class="highlighter-rouge">WebAssembly.Module</code> constructor</a>
</li>
  <li>
<code class="highlighter-rouge">WebAssembly.Instance</code> : the <a href="#webassemblyinstance-constructor"><code class="highlighter-rouge">WebAssembly.Instance</code> constructor</a>
</li>
  <li>
<code class="highlighter-rouge">WebAssembly.Memory</code> : the <a href="#webassemblymemory-constructor"><code class="highlighter-rouge">WebAssembly.Memory</code> constructor</a>
</li>
  <li>
<code class="highlighter-rouge">WebAssembly.Table</code> : the <a href="#webassemblytable-constructor"><code class="highlighter-rouge">WebAssembly.Table</code> constructor</a>
</li>
  <li>
<code class="highlighter-rouge">WebAssembly.CompileError</code> : a <a href="http://tc39.github.io/ecma262/#sec-nativeerror-object-structure">NativeError</a>
 which indicates an error during WebAssembly decoding or validation</li>
  <li>
<code class="highlighter-rouge">WebAssembly.LinkError</code> : a <a href="http://tc39.github.io/ecma262/#sec-nativeerror-object-structure">NativeError</a>
 which indicates an error during WebAssembly instantiating a module (other than traps from the start function)</li>
  <li>
<code class="highlighter-rouge">WebAssembly.RuntimeError</code> : a <a href="http://tc39.github.io/ecma262/#sec-nativeerror-object-structure">NativeError</a>
 which is thrown whenever WebAssembly specifies a <a href="#traps">trap</a>.</li>
</ul>

<h3 id="function-properties-of-the-webassembly-object">Function Properties of the <code class="highlighter-rouge">WebAssembly</code> object</h3>

<h4 id="webassemblyvalidate"><code class="highlighter-rouge">WebAssembly.validate</code></h4>

<p>The <code class="highlighter-rouge">validate</code> function has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Boolean validate(BufferSource bytes)
</code></pre>
</div>

<p>If the given <code class="highlighter-rouge">bytes</code> argument is not a
<a href="https://heycam.github.io/webidl/#common-BufferSource"><code class="highlighter-rouge">BufferSource</code></a>,
then a <code class="highlighter-rouge">TypeError</code> is thrown.</p>

<p>Otherwise, this function performs <em>validation</em> as defined by the <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/">WebAssembly
specification</a> and returns <code class="highlighter-rouge">true</code> if validation succeeded, <code class="highlighter-rouge">false</code> if validation failed.</p>

<h4 id="webassemblycompile"><code class="highlighter-rouge">WebAssembly.compile</code></h4>

<p>The <code class="highlighter-rouge">compile</code> function has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Promise&lt;WebAssembly.Module&gt; compile(BufferSource bytes)
</code></pre>
</div>

<p>If the given <code class="highlighter-rouge">bytes</code> argument is not a
<a href="https://heycam.github.io/webidl/#common-BufferSource"><code class="highlighter-rouge">BufferSource</code></a>,
the returned <code class="highlighter-rouge">Promise</code> is <a href="http://tc39.github.io/ecma262/#sec-rejectpromise">rejected</a>
with a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>.</p>

<p>Otherwise, this function starts an asynchronous task to compile a <code class="highlighter-rouge">WebAssembly.Module</code>
as described in the <a href="#webassemblymodule-constructor"><code class="highlighter-rouge">WebAssembly.Module</code> constructor</a>.
On success, the <code class="highlighter-rouge">Promise</code> is <a href="http://tc39.github.io/ecma262/#sec-fulfillpromise">fulfilled</a>
with the resulting <code class="highlighter-rouge">WebAssembly.Module</code> object. On failure, the <code class="highlighter-rouge">Promise</code> is 
<a href="http://tc39.github.io/ecma262/#sec-rejectpromise">rejected</a> with a 
<code class="highlighter-rouge">WebAssembly.CompileError</code>.</p>

<p>The asynchronous compilation is logically performed on a copy of the state of
the given <code class="highlighter-rouge">BufferSource</code> captured during the call to <code class="highlighter-rouge">compile</code>; subsequent mutations
of the <code class="highlighter-rouge">BufferSource</code> after <code class="highlighter-rouge">compile</code> return do not affect ongoing compilations.</p>

<p>In the <a href="../future-features/#streaming-compilation">future <img class="emoji" title=":unicorn:" alt=":unicorn:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f984.png" height="20" width="20" align="absmiddle"></a>, this function can be
extended to accept a <a href="https://streams.spec.whatwg.org">stream</a>, thereby enabling
asynchronous, background, streaming compilation.</p>

<h4 id="webassemblyinstantiate"><code class="highlighter-rouge">WebAssembly.instantiate</code></h4>

<p>The <code class="highlighter-rouge">instantiate</code> function is overloaded based on types of its arguments.
If neither of the following overloads match, then the returned <code class="highlighter-rouge">Promise</code> is
<a href="http://tc39.github.io/ecma262/#sec-rejectpromise">rejected</a>
with a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>dictionary WebAssemblyInstantiatedSource {
   required WebAssembly.Module module;
   required WebAssembly.Instance instance;
};

Promise&lt;WebAssemblyInstantiatedSource&gt;
  instantiate(BufferSource bytes [, importObject])
</code></pre>
</div>

<p>If the given <code class="highlighter-rouge">bytes</code> argument is not a
<a href="https://heycam.github.io/webidl/#common-BufferSource"><code class="highlighter-rouge">BufferSource</code></a>,
the returned <code class="highlighter-rouge">Promise</code> is <a href="http://tc39.github.io/ecma262/#sec-rejectpromise">rejected</a>
with a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>.</p>

<p>This function starts an asynchronous task that first compiles a <code class="highlighter-rouge">WebAssembly.Module</code>
from <code class="highlighter-rouge">bytes</code> as described in the <a href="#webassemblymodule-constructor"><code class="highlighter-rouge">WebAssembly.Module</code> constructor</a>
and then queue a task to instantiate the resulting <code class="highlighter-rouge">Module</code> with <code class="highlighter-rouge">importObject</code> as described in the
<a href="#webassemblyinstance-constructor"><code class="highlighter-rouge">WebAssembly.Instance</code> constructor</a>. After the instantiation task runs
and before any subsequent steps are taken, other unspecified asynchronous tasks may be run.
On success, the <code class="highlighter-rouge">Promise</code> is <a href="http://tc39.github.io/ecma262/#sec-fulfillpromise">fulfilled</a>
with a plain JavaScript object pair <code class="highlighter-rouge"><span class="p">{</span><span class="err">module,</span><span class="w"> </span><span class="err">instance</span><span class="p">}</span></code> containing the resulting
<code class="highlighter-rouge">WebAssembly.Module</code> and <code class="highlighter-rouge">WebAssembly.Instance</code>. The 2 properties <code class="highlighter-rouge">module</code> and <code class="highlighter-rouge">instance</code> of the returned pair are  configurable, enumerable and writable.</p>

<p>On failure, the <code class="highlighter-rouge">Promise</code> is
<a href="http://tc39.github.io/ecma262/#sec-rejectpromise">rejected</a> with a 
<code class="highlighter-rouge">WebAssembly.CompileError</code>, <code class="highlighter-rouge">WebAssembly.LinkError</code>, or <code class="highlighter-rouge">WebAssembly.RuntimeError</code>, depending on the cause of failure.</p>

<p>The asynchronous compilation is logically performed on a copy of the state of
the given <code class="highlighter-rouge">BufferSource</code> captured during the call to <code class="highlighter-rouge">instantiate</code>; subsequent mutations
of the <code class="highlighter-rouge">BufferSource</code> after <code class="highlighter-rouge">instantiate</code> return do not affect ongoing compilations.</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Promise&lt;WebAssembly.Instance&gt; instantiate(moduleObject [, importObject])
</code></pre>
</div>

<p>This description applies if the first argument is a <code class="highlighter-rouge">WebAssembly.Module</code> instance.</p>

<p>This function asynchronously queues a task that instantiates a <code class="highlighter-rouge">WebAssembly.Instance</code>
from <code class="highlighter-rouge">moduleObject</code> and <code class="highlighter-rouge">importObject</code> as described in the
<a href="#webassemblyinstance-constructor"><code class="highlighter-rouge">WebAssembly.Instance</code> constructor</a>. After the instantiation task runs
and before any subsequent steps are taken, other unspecified asynchronous tasks may be run.
On success, the <code class="highlighter-rouge">Promise</code> is <a href="http://tc39.github.io/ecma262/#sec-fulfillpromise">fulfilled</a>
with the resulting <code class="highlighter-rouge">WebAssembly.Instance</code> object. On failure, the <code class="highlighter-rouge">Promise</code> is
<a href="http://tc39.github.io/ecma262/#sec-rejectpromise">rejected</a> with a 
<code class="highlighter-rouge">WebAssembly.CompileError</code>, <code class="highlighter-rouge">WebAssembly.LinkError</code>, or <code class="highlighter-rouge">WebAssembly.RuntimeError</code>, depending on the cause of failure.</p>

<h2 id="webassemblymodule-objects">
<code class="highlighter-rouge">WebAssembly.Module</code> Objects</h2>

<p>A <code class="highlighter-rouge">WebAssembly.Module</code> object represents the stateless result of compiling a
WebAssembly binary-format module and contains one internal slot:</p>

<ul>
  <li>[[Module]] : an <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L176"><code class="highlighter-rouge">Ast.module</code></a>
which is the spec definition of a module</li>
</ul>

<h3 id="webassemblymodule-constructor">
<code class="highlighter-rouge">WebAssembly.Module</code> Constructor</h3>

<p>The <code class="highlighter-rouge">WebAssembly.Module</code> constructor has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>new Module(BufferSource bytes)
</code></pre>
</div>

<p>If the NewTarget is <code class="highlighter-rouge">undefined</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
exception is thrown (i.e., this constructor cannot be called as a function without <code class="highlighter-rouge">new</code>).</p>

<p>If the given <code class="highlighter-rouge">bytes</code> argument is not a
<a href="https://heycam.github.io/webidl/#common-BufferSource"><code class="highlighter-rouge">BufferSource</code></a>,
a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
exception is thrown.</p>

<p>Otherwise, this function performs synchronous compilation of the <code class="highlighter-rouge">BufferSource</code>:</p>

<ol>
  <li>The byte range delimited by the <code class="highlighter-rouge">BufferSource</code> is first logically decoded 
according to <a href="../binary-encoding/">BinaryEncoding.md</a> and then validated
according to the rules in <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/valid.ml#L415">spec/valid.ml</a>.</li>
  <li>The spec <code class="highlighter-rouge">string</code> values inside <code class="highlighter-rouge">Ast.module</code> are decoded as UTF8 as described in 
<a href="../web/#names">Web.md</a>.</li>
  <li>On success, a new <code class="highlighter-rouge">WebAssembly.Module</code> object is returned with [[Module]] set to
the validated <code class="highlighter-rouge">Ast.module</code>.</li>
  <li>On failure, a new <code class="highlighter-rouge">WebAssembly.CompileError</code> is thrown.</li>
</ol>

<h3 id="webassemblymoduleprototype--tostringtag--property">
<code class="highlighter-rouge">WebAssembly.Module.prototype [ @@toStringTag ]</code> Property</h3>

<p>The initial value of the <a href="https://tc39.github.io/ecma262/#sec-well-known-symbols"><code class="highlighter-rouge">@@toStringTag</code></a>
property is the String value <code class="highlighter-rouge">"WebAssembly.Module"</code>.</p>

<p>This property has the attributes { [[Writable]]: <code class="highlighter-rouge">false</code>, [[Enumerable]]: <code class="highlighter-rouge">false</code>, [[Configurable]]: <code class="highlighter-rouge">true</code> }.</p>

<h3 id="webassemblymoduleexports"><code class="highlighter-rouge">WebAssembly.Module.exports</code></h3>

<p>The <code class="highlighter-rouge">exports</code> function has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Array exports(moduleObject)
</code></pre>
</div>

<p>If <code class="highlighter-rouge">moduleObject</code> is not a <code class="highlighter-rouge">WebAssembly.Module</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>This function returns a new <code class="highlighter-rouge">Array</code> every time it is called. Each such <code class="highlighter-rouge">Array</code> is produced by mapping each
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L152"><code class="highlighter-rouge">Ast.export</code></a>
<code class="highlighter-rouge">e</code> of <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L187">moduleObject.[[Module]].exports</a>
to the Object <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="err">String(e.name),</span><span class="w"> </span><span class="err">kind:</span><span class="w"> </span><span class="err">e.ekind</span><span class="w"> </span><span class="p">}</span></code> where <code class="highlighter-rouge">e.name</code> is <a href="../web/#names">decoded as UTF8</a>
and <code class="highlighter-rouge">e.ekind</code> is mapped to one of the String values <code class="highlighter-rouge">"function"</code>, <code class="highlighter-rouge">"table"</code>, <code class="highlighter-rouge">"memory"</code>, <code class="highlighter-rouge">"global"</code>.</p>

<p>Note: other fields like <code class="highlighter-rouge">signature</code> may be added in the future.</p>

<p>The returned <code class="highlighter-rouge">Array</code> is populated in the same order exports appear in the WebAssembly binary’s exports table.</p>

<h3 id="webassemblymoduleimports"><code class="highlighter-rouge">WebAssembly.Module.imports</code></h3>

<p>The <code class="highlighter-rouge">imports</code> function has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Array imports(moduleObject)
</code></pre>
</div>

<p>If <code class="highlighter-rouge">moduleObject</code> is not a <code class="highlighter-rouge">WebAssembly.Module</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>This function returns a new <code class="highlighter-rouge">Array</code> every time it is called. Each such <code class="highlighter-rouge">Array</code> is produced by mapping each
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L167"><code class="highlighter-rouge">Ast.import</code></a>
<code class="highlighter-rouge">i</code> of <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L203">moduleObject.[[Module]].imports</a>
to the Object <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="err">module:</span><span class="w"> </span><span class="err">String(i.module_name),</span><span class="w"> </span><span class="err">name:</span><span class="w"> </span><span class="err">String(i.item_name),</span><span class="w"> </span><span class="err">kind:</span><span class="w"> </span><span class="err">i.ikind</span><span class="w"> </span><span class="p">}</span></code> where
<code class="highlighter-rouge">i.module_name</code> and <code class="highlighter-rouge">i.item_name</code> are  <a href="../web/#names">decoded as UTF8</a> and
<code class="highlighter-rouge">i.ikind</code> is mapped to one of the String values <code class="highlighter-rouge">"function"</code>, <code class="highlighter-rouge">"table"</code>, <code class="highlighter-rouge">"memory"</code>, <code class="highlighter-rouge">"global"</code>.</p>

<p>Note: other fields like <code class="highlighter-rouge">signature</code> may be added in the future.</p>

<p>The returned <code class="highlighter-rouge">Array</code> is populated in the same order imports appear in the WebAssembly binary’s imports table.</p>

<h3 id="webassemblymodulecustomsections"><code class="highlighter-rouge">WebAssembly.Module.customSections</code></h3>

<p>The <code class="highlighter-rouge">customSections</code> function has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>Array customSections(moduleObject, sectionName)
</code></pre>
</div>

<p>If <code class="highlighter-rouge">moduleObject</code> is not a <code class="highlighter-rouge">WebAssembly.Module</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">sectionNameString</code> be the result of <a href="https://tc39.github.io/ecma262/#sec-tostring"><code class="highlighter-rouge">ToString</code></a>(<code class="highlighter-rouge">sectionName</code>).</p>

<p>This function returns a new <code class="highlighter-rouge">Array</code> every time it is called. Each such <code class="highlighter-rouge">Array</code> is produced by mapping each
<a href="../binary-encoding/#high-level-structure">custom section</a> (i.e., section with
<code class="highlighter-rouge">id</code> 0) whose <code class="highlighter-rouge">name</code> field (<a href="../web/#names">decoded as UTF-8</a>) is equal to
<code class="highlighter-rouge">sectionNameString</code> to an <code class="highlighter-rouge">ArrayBuffer</code> containing a copy of the section’s
<code class="highlighter-rouge">payload_data</code>. (Note: <code class="highlighter-rouge">payload_data</code> does not include <code class="highlighter-rouge">name</code> or <code class="highlighter-rouge">name_len</code>.).</p>

<p>The <code class="highlighter-rouge">Array</code> is populated in the same order custom sections appear in the WebAssembly binary.</p>

<h3 id="structured-clone-of-a-webassemblymodule">Structured Clone of a <code class="highlighter-rouge">WebAssembly.Module</code>
</h3>

<p>A <code class="highlighter-rouge">WebAssembly.Module</code> is a
<a href="https://html.spec.whatwg.org/multipage/infrastructure.html#cloneable-objects">cloneable object</a>
which means it can be cloned between windows/workers and also
stored/retrieved into/from an <a href="https://w3c.github.io/IndexedDB/#object-store">IDBObjectStore</a>.
The semantics of a structured clone is as-if the binary source, from which the
<code class="highlighter-rouge">WebAssembly.Module</code> was compiled, were cloned and recompiled into the target realm.
Engines should attempt to share/reuse internal compiled code when performing
a structured clone although, in corner cases like CPU upgrade or browser
update, this may not be possible and full recompilation may be necessary.</p>

<p>Given the above engine optimizations, structured cloning provides developers
explicit control over both compiled-code caching and cross-window/worker code
sharing.</p>

<h2 id="webassemblyinstance-objects">
<code class="highlighter-rouge">WebAssembly.Instance</code> Objects</h2>

<p>A <code class="highlighter-rouge">WebAssembly.Instance</code> object represents the instantiation of a 
<code class="highlighter-rouge">WebAssembly.Module</code> into a
<a href="http://tc39.github.io/ecma262/#sec-code-realms">realm</a> and has one
internal slot:</p>

<ul>
  <li>[[Instance]] : an <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L17"><code class="highlighter-rouge">Instance.instance</code></a>
which is the WebAssembly spec definition of an instance</li>
  <li>[[Exports]] : the exports object created during instantiation</li>
</ul>

<h3 id="webassemblyinstance-constructor">
<code class="highlighter-rouge">WebAssembly.Instance</code> Constructor</h3>

<p>The <code class="highlighter-rouge">WebAssembly.Instance</code> constructor has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>new Instance(moduleObject [, importObject])
</code></pre>
</div>

<p>If the NewTarget is <code class="highlighter-rouge">undefined</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
exception is thrown (i.e., this
constructor cannot be called as a function without <code class="highlighter-rouge">new</code>).</p>

<p>If <code class="highlighter-rouge">moduleObject</code> is not a <code class="highlighter-rouge">WebAssembly.Module</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">module</code> be the <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L176"><code class="highlighter-rouge">Ast.module</code></a>
<code class="highlighter-rouge">moduleObject.[[Module]]</code>.</p>

<p>If the <code class="highlighter-rouge">importObject</code> parameter is not <code class="highlighter-rouge">undefined</code> and <code class="highlighter-rouge">Type(importObject)</code> is
not Object, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown. If the list of 
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L186"><code class="highlighter-rouge">module.imports</code></a>
is not empty and <code class="highlighter-rouge">Type(importObject)</code> is not Object, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Note: Imported JavaScript functions are wrapped as <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L9">host function</a> values in the following algorithm. For the purpose of the algorithm, a <em>new</em> <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L9">host function</a> value is always generated fresh and considered distinct from any other previously created host function value, including those wrapping the same JavaScript function object.
Consequently, two <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L7">closure</a> values are considered equal if and only if:</p>

<ul>
  <li>Either they are both WebAssembly functions for the same instance and referring to the same function definition.</li>
  <li>Or they are the same host function value.</li>
</ul>

<p>Let <code class="highlighter-rouge">funcs</code>, <code class="highlighter-rouge">memories</code> and <code class="highlighter-rouge">tables</code> be initially-empty lists of callable JavaScript objects, <code class="highlighter-rouge">WebAssembly.Memory</code> objects and <code class="highlighter-rouge">WebAssembly.Table</code> objects, respectively.</p>

<p>Let <code class="highlighter-rouge">imports</code> be an initially-empty list of <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L11"><code class="highlighter-rouge">external</code></a> values.</p>

<p>For each <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L168"><code class="highlighter-rouge">import</code></a>
<code class="highlighter-rouge">i</code> in <code class="highlighter-rouge">module.imports</code>:</p>

<ol>
  <li>Let <code class="highlighter-rouge">o</code> be the resultant value of performing
<a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">importObject</code>, <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L170"><code class="highlighter-rouge">i.module_name</code></a>).</li>
  <li>If <code class="highlighter-rouge">Type(o)</code> is not Object, throw a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>.</li>
  <li>Let <code class="highlighter-rouge">v</code> be the value of performing <a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">o</code>, <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/ast.ml#L171"><code class="highlighter-rouge">i.item_name</code></a>)</li>
  <li>If <code class="highlighter-rouge">i</code> is a function import:
    <ol>
      <li>If <a href="https://tc39.github.io/ecma262/#sec-iscallable"><code class="highlighter-rouge">IsCallable(v)</code></a> is <code class="highlighter-rouge">false</code>,
throw a <code class="highlighter-rouge">WebAssembly.LinkError</code>.</li>
      <li>If <code class="highlighter-rouge">v</code> is an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a>:
        <ol>
          <li>(The signature of <code class="highlighter-rouge">v.[[Closure]]</code> is checked against the import’s declared
<a href="https://github.com/WebAssembly/design/blob/master/BinaryEncoding.md#func_type"><code class="highlighter-rouge">func_type</code></a>
by <code class="highlighter-rouge">Eval.init</code> below.)</li>
          <li>Let <code class="highlighter-rouge">closure</code> be <code class="highlighter-rouge">v.[[Closure]]</code>.</li>
        </ol>
      </li>
      <li>Otherwise:
        <ol>
          <li>Let <code class="highlighter-rouge">closure</code> be a new <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L9">host function</a> value
of the given signature and the following behavior:</li>
          <li>If the signature contains an <code class="highlighter-rouge">i64</code> (as argument or result), the host
function immediately throws a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
when called.</li>
          <li>Otherwise, the host function calls <code class="highlighter-rouge">v</code> with an <code class="highlighter-rouge">undefined</code> receiver
and WebAssembly arguments coerced to JavaScript arguments
via <a href="#tojsvalue"><code class="highlighter-rouge">ToJSValue</code></a>. The result is returned by coercing
via <a href="#towebassemblyvalue"><code class="highlighter-rouge">ToWebAssemblyValue</code></a>.</li>
        </ol>
      </li>
      <li>Append <code class="highlighter-rouge">v</code> to <code class="highlighter-rouge">funcs</code>.</li>
      <li>Append <code class="highlighter-rouge">closure</code> to <code class="highlighter-rouge">imports</code>.</li>
    </ol>
  </li>
  <li>If <code class="highlighter-rouge">i</code> is a global import:
    <ol>
      <li>
<a href="https://tc39.github.io/ecma262/#assert">Assert</a>: the global is immutable
by MVP validation constraint.</li>
      <li>If the <code class="highlighter-rouge">global_type</code> of <code class="highlighter-rouge">i</code> is <code class="highlighter-rouge">i64</code> or <code class="highlighter-rouge">Type(v)</code> is not Number, throw a <code class="highlighter-rouge">WebAssembly.LinkError</code>.</li>
      <li>Append <a href="#towebassemblyvalue"><code class="highlighter-rouge">ToWebAssemblyValue</code></a><code class="highlighter-rouge">(v)</code> to <code class="highlighter-rouge">imports</code>.</li>
    </ol>
  </li>
  <li>If <code class="highlighter-rouge">i</code> is a memory import:
    <ol>
      <li>If <code class="highlighter-rouge">v</code> is not a <a href="#webassemblymemory-objects"><code class="highlighter-rouge">WebAssembly.Memory</code> object</a>,
throw a <code class="highlighter-rouge">WebAssembly.LinkError</code>.</li>
      <li>(The imported <code class="highlighter-rouge">Memory</code>’s <code class="highlighter-rouge">length</code> and <code class="highlighter-rouge">maximum</code> properties are checked against the import’s declared
<a href="https://github.com/WebAssembly/design/blob/master/BinaryEncoding.md#memory_type"><code class="highlighter-rouge">memory_type</code></a>
by <code class="highlighter-rouge">Eval.init</code> below.)</li>
      <li>Append <code class="highlighter-rouge">v</code> to <code class="highlighter-rouge">memories</code>.</li>
      <li>Append <code class="highlighter-rouge">v.[[Memory]]</code> to <code class="highlighter-rouge">imports</code>.</li>
    </ol>
  </li>
  <li>Otherwise (<code class="highlighter-rouge">i</code> is a table import):
    <ol>
      <li>If <code class="highlighter-rouge">v</code> is not a <a href="#webassemblytable-objects"><code class="highlighter-rouge">WebAssembly.Table</code> object</a>,
throw a <code class="highlighter-rouge">WebAssembly.LinkError</code>.</li>
      <li>(The imported <code class="highlighter-rouge">Table</code>’s <code class="highlighter-rouge">length</code>, <code class="highlighter-rouge">maximum</code> and <code class="highlighter-rouge">element</code> properties are checked against the import’s declared
<a href="https://github.com/WebAssembly/design/blob/master/BinaryEncoding.md#table_type"><code class="highlighter-rouge">table_type</code></a>
by <code class="highlighter-rouge">Eval.init</code> below.)</li>
      <li>Append <code class="highlighter-rouge">v</code> to <code class="highlighter-rouge">tables</code>.</li>
      <li>Append <code class="highlighter-rouge">v.[[Table]]</code> to <code class="highlighter-rouge">imports</code>.</li>
      <li>For each index <code class="highlighter-rouge">i</code> of <code class="highlighter-rouge">v.[[Table]]</code>:
        <ol>
          <li>Let <code class="highlighter-rouge">e</code> be the <code class="highlighter-rouge">i</code>the element of <code class="highlighter-rouge">v.[[Table]]</code>.</li>
        </ol>
      </li>
      <li>If <code class="highlighter-rouge">e</code> is a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L7"><code class="highlighter-rouge">closure</code></a> <code class="highlighter-rouge">c</code>:
        <ol>
          <li>Append the <code class="highlighter-rouge">i</code>th element of <code class="highlighter-rouge">v.[[Values]]</code> to <code class="highlighter-rouge">funcs</code>.</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<p>Let <code class="highlighter-rouge">instance</code> be the result of creating a new
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L17"><code class="highlighter-rouge">instance</code></a>
by calling
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/eval.ml#L416"><code class="highlighter-rouge">Eval.init</code></a>
given <code class="highlighter-rouge">module</code> and <code class="highlighter-rouge">imports</code>.
If this terminates with a <code class="highlighter-rouge">Link</code> error, throw a <code class="highlighter-rouge">WebAssembly.LinkError</code>; if it causes a trap, throw a <code class="highlighter-rouge">WebAssembly.RuntimeError</code>; all other exceptions are propagated to the caller.
Among other things, this function performs the following observable steps:</p>

<ul>
  <li>
    <p>If, after evaluating the <code class="highlighter-rouge">offset</code> <a href="../modules/#initializer-expression">initializer expression</a>
of every <a href="../modules/#data-section">Data</a> and <a href="../modules/#elements-section">Element</a>
Segment, any of the segments do not fit in their respective Memory or Table, throw a 
<code class="highlighter-rouge">WebAssembly.LinkError</code>.</p>
  </li>
  <li>
    <p>Apply all Data and Element segments to their respective Memory or Table in the
order in which they appear in the module. Segments may overlap and, if they do,
the final value is the last value written in order. Note: there should be no
errors possible that would cause this operation to fail partway through. After
this operation completes, elements of <code class="highlighter-rouge">instance</code> are visible and callable
through <a href="../modules/#imports">imported tables</a>, even if <code class="highlighter-rouge">start</code> fails.</p>
  </li>
  <li>
    <p>If a <a href="../modules/#module-start-function"><code class="highlighter-rouge">start</code></a> is present, it is evaluated.
Any errors thrown by <code class="highlighter-rouge">start</code> are propagated to the caller.</p>
  </li>
</ul>

<p>The following steps are performed <em>before</em> the <code class="highlighter-rouge">start</code> function executes:</p>

<ol>
  <li>For each table ‘t’ in <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L17"><code class="highlighter-rouge">instance.tables</code></a>:
    <ol>
      <li>If there is no element in <code class="highlighter-rouge">tables</code> whose <code class="highlighter-rouge">table.[[Table]]</code> is <code class="highlighter-rouge">t</code>:
        <ol>
          <li>Let <code class="highlighter-rouge">table</code> be a new <code class="highlighter-rouge">WebAssembly.Table</code> object with [[Table]] set to <code class="highlighter-rouge">t</code> and [[Values]] set to a new list of the same length all whose entries are <code class="highlighter-rouge">null</code>.</li>
          <li>Append <code class="highlighter-rouge">table</code> to <code class="highlighter-rouge">tables</code>.</li>
        </ol>
      </li>
      <li>Otherwise:
        <ol>
          <li>Let <code class="highlighter-rouge">table</code> be the element in <code class="highlighter-rouge">tables</code> whose <code class="highlighter-rouge">table.[[Table]]</code> is <code class="highlighter-rouge">t</code>
</li>
        </ol>
      </li>
      <li>(Note: At most one <code class="highlighter-rouge">WebAssembly.Table</code> object is created for any table, so the above <code class="highlighter-rouge">table</code> is unique, even if there are multiple occurrances in the list. Moreover, if the item was an import, the original object will be found.)</li>
      <li>For each index <code class="highlighter-rouge">i</code> of <code class="highlighter-rouge">t</code>:
        <ol>
          <li>Let <code class="highlighter-rouge">c</code> be the <code class="highlighter-rouge">i</code>th element of <code class="highlighter-rouge">t</code>
</li>
          <li>If <code class="highlighter-rouge">c</code> is a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L7"><code class="highlighter-rouge">closure</code></a> <code class="highlighter-rouge">c</code>:
            <ol>
              <li>If there is an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a> in <code class="highlighter-rouge">funcs</code> whose <code class="highlighter-rouge">[[Closure]]</code> equals <code class="highlighter-rouge">c</code>:
                <ol>
                  <li>Let <code class="highlighter-rouge">func</code> be that function object.</li>
                </ol>
              </li>
              <li>(Note: At most one wrapper is created for any closure, so <code class="highlighter-rouge">func</code> is uniquely determined. Moreover, if the item was an import that is already an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a>, then the original function object will be found. For imports that are regular JS functions, a new wrapper will be created.)</li>
              <li>Otherwise:
                <ol>
                  <li>Let <code class="highlighter-rouge">func</code> be an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a> created from <code class="highlighter-rouge">c</code>.</li>
                  <li>Append <code class="highlighter-rouge">func</code> to <code class="highlighter-rouge">funcs</code>.</li>
                </ol>
              </li>
              <li>Set the <code class="highlighter-rouge">i</code>th element of <code class="highlighter-rouge">table.[[Values]]</code> to <code class="highlighter-rouge">func</code>.</li>
            </ol>
          </li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<p>(Note: The table and element function objects created by the above steps are only observable for tables that are either imported or exported.)</p>

<p>Let <code class="highlighter-rouge">exports</code> be a list of (string, JS value) pairs that is mapped from 
each <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L24">external</a> value <code class="highlighter-rouge">e</code> in <code class="highlighter-rouge">instance.exports</code> as follows:</p>

<ol>
  <li>If <code class="highlighter-rouge">e</code> is a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L12">closure</a> <code class="highlighter-rouge">c</code>:
    <ol>
      <li>If there is an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a> <code class="highlighter-rouge">func</code> in <code class="highlighter-rouge">funcs</code> whose <code class="highlighter-rouge">func.[[Closure]]</code> equals <code class="highlighter-rouge">c</code>, then return <code class="highlighter-rouge">func</code>.</li>
      <li>(Note: At most one wrapper is created for any closure, so <code class="highlighter-rouge">func</code> is unique, even if there are multiple occurrances in the list. Moreover, if the item was an import that is already an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a>, then the original function object will be found. For imports that are regular JS functions, a new wrapper will be created.)</li>
      <li>Otherwise:
        <ol>
          <li>Let <code class="highlighter-rouge">func</code> be an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a> created from <code class="highlighter-rouge">c</code>.</li>
          <li>Append <code class="highlighter-rouge">func</code> to <code class="highlighter-rouge">funcs</code>.</li>
          <li>Return <code class="highlighter-rouge">func</code>.</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>If <code class="highlighter-rouge">e</code> is a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L15">global</a> <code class="highlighter-rouge">v</code>:
    <ol>
      <li>
<a href="https://tc39.github.io/ecma262/#assert">Assert</a>: the global is immutable
by MVP validation constraint.</li>
      <li>If <code class="highlighter-rouge">v</code> is an <code class="highlighter-rouge">i64</code>, throw a <code class="highlighter-rouge">WebAssembly.LinkError</code>.</li>
      <li>Return <a href="#tojsvalue"><code class="highlighter-rouge">ToJSValue</code></a><code class="highlighter-rouge">(v)</code>.</li>
    </ol>
  </li>
  <li>If <code class="highlighter-rouge">e</code> is a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L14">memory</a> <code class="highlighter-rouge">m</code>:
    <ol>
      <li>If there is an element <code class="highlighter-rouge">memory</code> in <code class="highlighter-rouge">memories</code> whose <code class="highlighter-rouge">memory.[[Memory]]</code> is <code class="highlighter-rouge">m</code>, then return <code class="highlighter-rouge">memory</code>.</li>
      <li>(Note: At most one <code class="highlighter-rouge">WebAssembly.Memory</code> object is created for any memory, so the above <code class="highlighter-rouge">memory</code> is unique, even if there are multiple occurrances in the list. Moreover, if the item was an import, the original object will be found.)</li>
      <li>Otherwise:
        <ol>
          <li>Let <code class="highlighter-rouge">memory</code> be a new <code class="highlighter-rouge">WebAssembly.Memory</code> object created via <a href="#creatememoryobject"><code class="highlighter-rouge">CreateMemoryObject</code></a> from <code class="highlighter-rouge">m</code>.</li>
          <li>Append <code class="highlighter-rouge">memory</code> to <code class="highlighter-rouge">memories</code>.</li>
          <li>Return <code class="highlighter-rouge">memory</code>.</li>
        </ol>
      </li>
    </ol>
  </li>
  <li>Otherwise <code class="highlighter-rouge">e</code> must be a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L13">table</a> <code class="highlighter-rouge">t</code>:
    <ol>
      <li>Assert: There is an element <code class="highlighter-rouge">table</code> in <code class="highlighter-rouge">tables</code> whose <code class="highlighter-rouge">table.[[Table]]</code> is <code class="highlighter-rouge">t</code>.</li>
      <li>Return that <code class="highlighter-rouge">table</code>.</li>
    </ol>
  </li>
</ol>

<p>Let <code class="highlighter-rouge">exportsObject</code> be a new <a href="https://tc39.github.io/ecma262/#sec-object.freeze">frozen</a>
plain JS object with [[Prototype]] set to Null and with properties defined
by mapping each export in <code class="highlighter-rouge">exports</code> to an enumerable, non-writable,
non-configurable data property. Note: the validity and uniqueness checks
performed during <a href="#webassemblymodule-constructor">module validation</a> ensure
that each property name is valid and no properties are defined twice.</p>

<p>Let <code class="highlighter-rouge">instanceObject</code> be a new <code class="highlighter-rouge">WebAssembly.Instance</code> object setting
the internal <code class="highlighter-rouge">[[Instance]]</code> slot to <code class="highlighter-rouge">instance</code> and the <code class="highlighter-rouge">[[Exports]]</code> slot to
<code class="highlighter-rouge">exportsObject</code>.</p>

<p>Return <code class="highlighter-rouge">instanceObject</code>.</p>

<h3 id="webassemblyinstanceprototype--tostringtag--property">
<code class="highlighter-rouge">WebAssembly.Instance.prototype [ @@toStringTag ]</code> Property</h3>

<p>The initial value of the <a href="https://tc39.github.io/ecma262/#sec-well-known-symbols"><code class="highlighter-rouge">@@toStringTag</code></a>
property is the String value <code class="highlighter-rouge">"WebAssembly.Instance"</code>.</p>

<p>This property has the attributes { [[Writable]]: <code class="highlighter-rouge">false</code>, [[Enumerable]]: <code class="highlighter-rouge">false</code>, [[Configurable]]: <code class="highlighter-rouge">true</code> }.</p>

<h3 id="webassemblyinstanceprototypeexports-property">
<code class="highlighter-rouge">WebAssembly.Instance.prototype.exports</code> property</h3>

<p>This is an accessor property whose [[Set]] is Undefined and whose [[Get]]
accessor function performs the following steps:</p>

<p>Let <code class="highlighter-rouge">T</code> be the <code class="highlighter-rouge">this</code> value. If <code class="highlighter-rouge">T</code> is not a <code class="highlighter-rouge">WebAssembly.Instance</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Return <code class="highlighter-rouge">T.[[Exports]]</code>.</p>

<h2 id="exported-function-exotic-objects">Exported Function Exotic Objects</h2>

<p>A function with <a href="../modules/#function-index-space">function index</a> <code class="highlighter-rouge">index</code>
from an <code class="highlighter-rouge">Instance</code> <code class="highlighter-rouge">inst</code> is reflected to JS via a new kind of <em>Exported
Function</em> <a href="http://tc39.github.io/ecma262/#sec-built-in-exotic-object-internal-methods-and-slots">Exotic Object</a>.
Like <a href="http://tc39.github.io/ecma262/#sec-bound-function-exotic-objects">Bound Function</a> Exotic Object,
Exported Functions do not have the normal function internal slots but instead have:</p>

<ul>
  <li>[[Closure]] : the <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/instance.ml#L7">closure</a>
(<code class="highlighter-rouge">index</code>, <code class="highlighter-rouge">inst</code>)</li>
</ul>

<p>as well as the internal slots required of all builtin functions:</p>

<ul>
  <li>[[Prototype]] : <a href="http://tc39.github.io/ecma262/#sec-well-known-intrinsic-objects">%FunctionPrototype%</a>
</li>
  <li>[[Extensible]] : <code class="highlighter-rouge">true</code>
</li>
  <li>[[Realm]] : the <a href="http://tc39.github.io/ecma262/#current-realm">current Realm Record</a>
</li>
  <li>[[ScriptOrModule]] : <a href="http://tc39.github.io/ecma262/#sec-getactivescriptormodule"><code class="highlighter-rouge">GetActiveScriptOrModule</code></a>
</li>
</ul>

<p>Exported Functions also have the following data properties:</p>

<ul>
  <li>the <code class="highlighter-rouge">length</code> property is set to the exported function’s signature’s arity</li>
  <li>the <code class="highlighter-rouge">name</code> is set to <a href="https://tc39.github.io/ecma262/#sec-tostring"><code class="highlighter-rouge">ToString</code></a>(<code class="highlighter-rouge">index</code>)</li>
</ul>

<p>WebAssembly Exported Functions have a <code class="highlighter-rouge">[[Call]](this, argValues)</code> method defined as:</p>

<ol>
  <li>Let <code class="highlighter-rouge">sig</code> be the <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/eval.ml#L106"><code class="highlighter-rouge">function type</code></a>
of the function’s [[Closure]].</li>
  <li>If <code class="highlighter-rouge">sig</code> contains an <code class="highlighter-rouge">i64</code> (as argument or result), a
<a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown each time the [[Call]] method is invoked.</li>
  <li>Let <code class="highlighter-rouge">args</code> be an empty list of coerced values.</li>
  <li>Let <code class="highlighter-rouge">inArity</code> be the number of arguments and <code class="highlighter-rouge">outArity</code> be the number of results in <code class="highlighter-rouge">sig</code>.</li>
  <li>For all values <code class="highlighter-rouge">v</code> in <code class="highlighter-rouge">argValues</code>, in the order of their appearance:</li>
  <li>If the length of<code class="highlighter-rouge">args</code> is less than <code class="highlighter-rouge">inArity</code>, append <a href="#towebassemblyvalue"><code class="highlighter-rouge">ToWebAssemblyValue</code></a><code class="highlighter-rouge">(v)</code> to <code class="highlighter-rouge">args</code>.</li>
  <li>While the length of <code class="highlighter-rouge">args</code> is less than <code class="highlighter-rouge">inArity</code>, append <a href="#towebassemblyvalue"><code class="highlighter-rouge">ToWebAssemblyValue</code></a><code class="highlighter-rouge">(undefined)</code> to <code class="highlighter-rouge">args</code>.</li>
  <li>Let <code class="highlighter-rouge">ret</code> be the result of calling <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/eval.ml#L443"><code class="highlighter-rouge">Eval.invoke</code></a>
passing [[Closure]], and <code class="highlighter-rouge">args</code>.</li>
  <li>If <code class="highlighter-rouge">outArity</code> is 0, return <code class="highlighter-rouge">undefined</code>.</li>
  <li>Otherwise, return <a href="#tojsvalue"><code class="highlighter-rouge">ToJSValue</code></a><code class="highlighter-rouge">(v)</code>, where <code class="highlighter-rouge">v</code> is the singular element of <code class="highlighter-rouge">ret</code>.</li>
</ol>

<p><code class="highlighter-rouge">[[Call]](this, argValues)</code> executes in the [[Realm]] of the callee Exported Function. This corresponds to <a href="https://tc39.github.io/ecma262/#sec-built-in-function-objects">the requirements of builtin function objects in JavaScript</a>.</p>

<p>Exported Functions do not have a [[Construct]] method and thus it is not possible to 
call one with the <code class="highlighter-rouge">new</code> operator.</p>

<h2 id="webassemblymemory-objects">
<code class="highlighter-rouge">WebAssembly.Memory</code> Objects</h2>

<p>A <code class="highlighter-rouge">WebAssembly.Memory</code> object contains a single <a href="../semantics/#linear-memory">linear memory</a>
which can be simultaneously referenced by multiple <code class="highlighter-rouge">Instance</code> objects. Each
<code class="highlighter-rouge">Memory</code> object has two internal slots:</p>

<ul>
  <li>[[Memory]] : a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/memory.mli"><code class="highlighter-rouge">Memory.memory</code></a>
</li>
  <li>[[BufferObject]] : the current <code class="highlighter-rouge">ArrayBuffer</code> whose [[ArrayBufferByteLength]]
matches the current byte length of [[Memory]]</li>
</ul>

<h3 id="webassemblymemory-constructor">
<code class="highlighter-rouge">WebAssembly.Memory</code> Constructor</h3>

<p>The <code class="highlighter-rouge">WebAssembly.Memory</code> constructor has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>new Memory(memoryDescriptor)
</code></pre>
</div>

<p>If the NewTarget is <code class="highlighter-rouge">undefined</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
exception is thrown (i.e., this constructor cannot be called as a function without <code class="highlighter-rouge">new</code>).</p>

<p>If <code class="highlighter-rouge">Type(memoryDescriptor)</code> is not Object, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">initial</code> be <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">memoryDescriptor</code>, <code class="highlighter-rouge">"initial"</code>)).</p>

<p>If <a href="http://tc39.github.io/ecma262/#sec-hasproperty"><code class="highlighter-rouge">HasProperty</code></a>(<code class="highlighter-rouge">"maximum"</code>),
then let <code class="highlighter-rouge">maximum</code> be <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">memoryDescriptor</code>, <code class="highlighter-rouge">"maximum"</code>)).
If <code class="highlighter-rouge">maximum</code> is smaller than <code class="highlighter-rouge">initial</code>, then throw a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a>.
Otherwise, let <code class="highlighter-rouge">maximum</code> be <code class="highlighter-rouge">None</code>.</p>

<p>Let <code class="highlighter-rouge">memory</code> be the result of calling 
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/memory.ml#L68"><code class="highlighter-rouge">Memory.create</code></a>
given arguments <code class="highlighter-rouge">initial</code> and <code class="highlighter-rouge">maximum</code>. Note that <code class="highlighter-rouge">initial</code> and <code class="highlighter-rouge">maximum</code> are
specified in units of WebAssembly pages (64KiB).</p>

<p>Return the result of <a href="#creatememoryobject"><code class="highlighter-rouge">CreateMemoryObject</code></a>(<code class="highlighter-rouge">memory</code>).</p>

<h3 id="creatememoryobject">CreateMemoryObject</h3>

<p>Given a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/memory.mli#L1"><code class="highlighter-rouge">Memory.memory</code></a>
<code class="highlighter-rouge">m</code>, to create a <code class="highlighter-rouge">WebAssembly.Memory</code>:</p>

<p>Let <code class="highlighter-rouge">buffer</code> be a new <code class="highlighter-rouge">ArrayBuffer</code> whose
<a href="http://tc39.github.io/ecma262/#sec-properties-of-the-arraybuffer-prototype-object">[[ArrayBufferData]]</a>
aliases <code class="highlighter-rouge">m</code> and whose 
<a href="http://tc39.github.io/ecma262/#sec-properties-of-the-arraybuffer-prototype-object">[[ArrayBufferByteLength]]</a>
is set to the byte length of <code class="highlighter-rouge">m</code>.</p>

<p>Any attempts to <a href="http://tc39.github.io/ecma262/#sec-detacharraybuffer"><code class="highlighter-rouge">detach</code></a> <code class="highlighter-rouge">buffer</code> <em>other</em> than
the detachment performed by <a href="#webassemblymemoryprototypegrow"><code class="highlighter-rouge">m.grow</code></a> shall throw a 
<a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a></p>

<p>Return a new <code class="highlighter-rouge">WebAssembly.Memory</code> instance with [[Memory]] set to <code class="highlighter-rouge">m</code> and
[[BufferObject]] set to <code class="highlighter-rouge">buffer</code>.</p>

<h3 id="webassemblymemoryprototype--tostringtag--property">
<code class="highlighter-rouge">WebAssembly.Memory.prototype [ @@toStringTag ]</code> Property</h3>

<p>The initial value of the <a href="https://tc39.github.io/ecma262/#sec-well-known-symbols"><code class="highlighter-rouge">@@toStringTag</code></a>
property is the String value <code class="highlighter-rouge">"WebAssembly.Memory"</code>.</p>

<p>This property has the attributes { [[Writable]]: <code class="highlighter-rouge">false</code>, [[Enumerable]]: <code class="highlighter-rouge">false</code>, [[Configurable]]: <code class="highlighter-rouge">true</code> }.</p>

<h3 id="webassemblymemoryprototypegrow"><code class="highlighter-rouge">WebAssembly.Memory.prototype.grow</code></h3>

<p>The <code class="highlighter-rouge">grow</code> method has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>grow(delta)
</code></pre>
</div>

<p>Let <code class="highlighter-rouge">M</code> be the <code class="highlighter-rouge">this</code> value. If <code class="highlighter-rouge">M</code> is not a <code class="highlighter-rouge">WebAssembly.Memory</code>,
a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">d</code> be <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<code class="highlighter-rouge">delta</code>).</p>

<p>Let <code class="highlighter-rouge">ret</code> be the current size of memory in pages (before resizing).</p>

<p>Perform <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/memory.mli#L27"><code class="highlighter-rouge">Memory.grow</code></a>
with delta <code class="highlighter-rouge">d</code>. On failure, a 
<a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a>
is thrown.</p>

<p>Perform <a href="http://tc39.github.io/ecma262/#sec-detacharraybuffer"><code class="highlighter-rouge">DetachArrayBuffer</code></a>(<code class="highlighter-rouge">M.[[BufferObject]]</code>).</p>

<p>Assign to <code class="highlighter-rouge">M.[[BufferObject]]</code> a new <code class="highlighter-rouge">ArrayBuffer</code> whose
<a href="http://tc39.github.io/ecma262/#sec-properties-of-the-arraybuffer-prototype-object">[[ArrayBufferData]]</a>
aliases <code class="highlighter-rouge">M.[[Memory]]</code> and whose 
<a href="http://tc39.github.io/ecma262/#sec-properties-of-the-arraybuffer-prototype-object">[[ArrayBufferByteLength]]</a>
is set to the new byte length of <code class="highlighter-rouge">M.[[Memory]]</code>.</p>

<p>Return <code class="highlighter-rouge">ret</code> as a Number value.</p>

<h3 id="webassemblymemoryprototypebuffer"><code class="highlighter-rouge">WebAssembly.Memory.prototype.buffer</code></h3>

<p>This is an accessor property whose [[Set]] is Undefined and whose [[Get]]
accessor function performs the following steps:</p>

<p>If <code class="highlighter-rouge">this</code> is not a <code class="highlighter-rouge">WebAssembly.Memory</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown. Otherwise return <code class="highlighter-rouge">M.[[BufferObject]]</code>.</p>

<h2 id="webassemblytable-objects">
<code class="highlighter-rouge">WebAssembly.Table</code> Objects</h2>

<p>A <code class="highlighter-rouge">WebAssembly.Table</code> object contains a single <a href="../semantics/#table">table</a>
which can be simultaneously referenced by multiple <code class="highlighter-rouge">Instance</code> objects. Each
<code class="highlighter-rouge">Table</code> object has two internal slots:</p>

<ul>
  <li>[[Table]] : a <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/table.mli#L1"><code class="highlighter-rouge">Table.table</code></a>
</li>
  <li>[[Values]] : an array whose elements are either <code class="highlighter-rouge">null</code> or <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a>
</li>
</ul>

<h3 id="webassemblytable-constructor">
<code class="highlighter-rouge">WebAssembly.Table</code> Constructor</h3>

<p>The <code class="highlighter-rouge">WebAssembly.Table</code> constructor has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>new Table(tableDescriptor)
</code></pre>
</div>

<p>If the NewTarget is <code class="highlighter-rouge">undefined</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
exception is thrown (i.e., this constructor cannot be called as a function without <code class="highlighter-rouge">new</code>).</p>

<p>If <code class="highlighter-rouge">Type(tableDescriptor)</code> is not Object, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">element</code> be the result of calling <a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">tableDescriptor</code>, <code class="highlighter-rouge">"element"</code>).
If <code class="highlighter-rouge">element</code> is not the string <code class="highlighter-rouge">"anyfunc"</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.
(Note: this check is intended to be relaxed in the
<a href="../future-features/#more-table-operators-and-types">future <img class="emoji" title=":unicorn:" alt=":unicorn:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f984.png" height="20" width="20" align="absmiddle"></a> to allow different element types.)</p>

<p>Let <code class="highlighter-rouge">initial</code> be <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">tableDescriptor</code>, <code class="highlighter-rouge">"initial"</code>)).</p>

<p>If <a href="http://tc39.github.io/ecma262/#sec-hasproperty"><code class="highlighter-rouge">HasProperty</code></a>(<code class="highlighter-rouge">"maximum"</code>),
then let <code class="highlighter-rouge">maximum</code> be <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<a href="http://tc39.github.io/ecma262/#sec-get-o-p"><code class="highlighter-rouge">Get</code></a>(<code class="highlighter-rouge">tableDescriptor</code>, <code class="highlighter-rouge">"maximum"</code>)). Otherwise, let <code class="highlighter-rouge">maximum</code> be None.</p>

<p>If <code class="highlighter-rouge">maximum</code> is not None and is smaller than <code class="highlighter-rouge">initial</code>, then throw a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a>.</p>

<p>Let <code class="highlighter-rouge">table</code> be the result of calling 
<a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/table.ml#L68"><code class="highlighter-rouge">Table.create</code></a>
given arguments <code class="highlighter-rouge">AnyFuncType</code>, <code class="highlighter-rouge">initial</code> and <code class="highlighter-rouge">maximum</code>.</p>

<p>Let <code class="highlighter-rouge">values</code> be a new empty array of <code class="highlighter-rouge">initial</code> elements, all with value
<code class="highlighter-rouge">null</code>.</p>

<p>Return a new <code class="highlighter-rouge">WebAssemby.Table</code> instance with [[Table]] set to <code class="highlighter-rouge">table</code> and
[[Values]] set to <code class="highlighter-rouge">values</code>.</p>

<h3 id="webassemblytableprototypelength"><code class="highlighter-rouge">WebAssembly.Table.prototype.length</code></h3>

<p>This is an accessor property whose [[Set]] is Undefined and whose [[Get]]
accessor function performs the following steps:</p>

<p>Let <code class="highlighter-rouge">T</code> be the <code class="highlighter-rouge">this</code> value. If <code class="highlighter-rouge">T</code> is not a <code class="highlighter-rouge">WebAssembly.Table</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Return <code class="highlighter-rouge">T.[[Values]].length</code>.</p>

<h3 id="webassemblytableprototypegrow"><code class="highlighter-rouge">WebAssembly.Table.prototype.grow</code></h3>

<p>The <code class="highlighter-rouge">grow</code> method has the signature:</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>grow(delta)
</code></pre>
</div>

<p>Let <code class="highlighter-rouge">T</code> be the <code class="highlighter-rouge">this</code> value. If <code class="highlighter-rouge">T</code> is not a <code class="highlighter-rouge">WebAssembly.Table</code>,
a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">d</code> be <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<code class="highlighter-rouge">delta</code>).</p>

<p>Let <code class="highlighter-rouge">ret</code> be the current length of the table (before resizing).</p>

<p>Perform <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/table.ml#L40"><code class="highlighter-rouge">Table.grow</code></a>,
with delta <code class="highlighter-rouge">d</code>. On failure, a
<a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a>
is thrown.</p>

<p>Return <code class="highlighter-rouge">ret</code> as a Number value.</p>

<h3 id="webassemblytableprototypeget"><code class="highlighter-rouge">WebAssembly.Table.prototype.get</code></h3>

<p>This method has the following signature</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>get(index)
</code></pre>
</div>

<p>Let <code class="highlighter-rouge">T</code> be the <code class="highlighter-rouge">this</code> value. If <code class="highlighter-rouge">T</code> is not a <code class="highlighter-rouge">WebAssembly.Table</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>Let <code class="highlighter-rouge">i</code> be the result of <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<code class="highlighter-rouge">index</code>).</p>

<p>If <code class="highlighter-rouge">i</code> is greater or equal than the length of <code class="highlighter-rouge">T.[[Values]]</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a> is thrown.</p>

<p>Return <code class="highlighter-rouge">T.[[Values]][i]</code>.</p>

<h3 id="webassemblytableprototypeset"><code class="highlighter-rouge">WebAssembly.Table.prototype.set</code></h3>

<p>This method has the following signature</p>

<div class="highlighter-rouge">
<pre class="highlight"><code>set(index, value)
</code></pre>
</div>

<p>Let <code class="highlighter-rouge">T</code> be the <code class="highlighter-rouge">this</code> value. If <code class="highlighter-rouge">T</code> is not a <code class="highlighter-rouge">WebAssembly.Table</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>
is thrown.</p>

<p>If <code class="highlighter-rouge">value</code> is not an <a href="#exported-function-exotic-objects">Exported Function Exotic Object</a>
or <code class="highlighter-rouge">null</code>, throw a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-typeerror"><code class="highlighter-rouge">TypeError</code></a>.</p>

<p>Let <code class="highlighter-rouge">i</code> be the result of <a href="#tononwrappinguint32"><code class="highlighter-rouge">ToNonWrappingUint32</code></a>(<code class="highlighter-rouge">index</code>).</p>

<p>If <code class="highlighter-rouge">i</code> is greater or equal than the length of <code class="highlighter-rouge">T.[[Values]]</code>, a <a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a> is thrown.</p>

<p>If <code class="highlighter-rouge">value</code> is <code class="highlighter-rouge">null</code>, let <code class="highlighter-rouge">elem</code> be <code class="highlighter-rouge">Uninitialized</code>;
otherwise, let <code class="highlighter-rouge">elem</code> be <code class="highlighter-rouge">value.[[Closure]]</code>.</p>

<p>Set <code class="highlighter-rouge">T.[[Table]][i]</code> to <code class="highlighter-rouge">elem</code>.</p>

<p>Set <code class="highlighter-rouge">T.[[Values]][i]</code> to <code class="highlighter-rouge">value</code>.</p>

<p>Return <code class="highlighter-rouge">undefined</code>.</p>

<h3 id="webassemblytableprototype--tostringtag--property">
<code class="highlighter-rouge">WebAssembly.Table.prototype [ @@toStringTag ]</code> Property</h3>

<p>The initial value of the <a href="https://tc39.github.io/ecma262/#sec-well-known-symbols"><code class="highlighter-rouge">@@toStringTag</code></a>
property is the String value <code class="highlighter-rouge">"WebAssembly.Table"</code>.</p>

<p>This property has the attributes { [[Writable]]: <code class="highlighter-rouge">false</code>, [[Enumerable]]: <code class="highlighter-rouge">false</code>, [[Configurable]]: <code class="highlighter-rouge">true</code> }.</p>

<h2 id="tojsvalue">ToJSValue</h2>

<p>To coerce a WebAssembly <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/values.ml#L9"><code class="highlighter-rouge">value</code></a>
to a JavaScript value:</p>

<p>Assert: the WebAssembly value’s type is not <code class="highlighter-rouge">i64</code>.</p>

<ol>
  <li>given a WebAssembly <code class="highlighter-rouge">i32</code> is interpreted as a signed integer, converted (losslessly) to an
  IEEE754 double and then returned as a JavaScript Number</li>
  <li>given a WebAssembly <code class="highlighter-rouge">f32</code> (single-precision IEEE754), convert (losslessly) to
a IEEE754 double, <a href="http://tc39.github.io/ecma262/#sec-setvalueinbuffer">possibly canonicalize NaN</a>,
and return as a JavaScript Number</li>
  <li>given a WebAssembly <code class="highlighter-rouge">f64</code>, <a href="http://tc39.github.io/ecma262/#sec-setvalueinbuffer">possibly canonicalize NaN</a>
and return as a JavaScript Number</li>
</ol>

<p>If the WebAssembly value is optional, then given <code class="highlighter-rouge">None</code>, return JavaScript value
<code class="highlighter-rouge">undefined</code>.</p>

<h2 id="towebassemblyvalue">ToWebAssemblyValue</h2>

<p>To coerce a JavaScript value to a given WebAssembly <a href="https://github.com/WebAssembly/spec/blob/master/interpreter/spec/types.ml#L3"><code class="highlighter-rouge">value type</code></a>,</p>

<p>Assert: the target value type is not <code class="highlighter-rouge">i64</code>.</p>

<ol>
  <li>coerce to <code class="highlighter-rouge">i32</code> via <a href="http://tc39.github.io/ecma262/#sec-toint32"><code class="highlighter-rouge">ToInt32(v)</code></a>
</li>
  <li>coerce to <code class="highlighter-rouge">f32</code> by first applying <a href="http://tc39.github.io/ecma262/#sec-tonumber"><code class="highlighter-rouge">ToNumber(v)</code></a>
and then converting the resulting IEEE754 64-bit double to a 32-bit float using <code class="highlighter-rouge">roundTiesToEven</code>
</li>
  <li>coerce to <code class="highlighter-rouge">f64</code> via <a href="http://tc39.github.io/ecma262/#sec-tonumber"><code class="highlighter-rouge">ToNumber(v)</code></a>
</li>
</ol>

<p>If the value type is optional, then given <code class="highlighter-rouge">None</code>, the JavaScript value is
ignored.</p>

<h2 id="tononwrappinguint32">ToNonWrappingUint32</h2>

<p>To convert a JavaScript value <code class="highlighter-rouge">v</code> to an unsigned integer in the range [0, <code class="highlighter-rouge">UINT32_MAX</code>]:</p>

<p>Let <code class="highlighter-rouge">i</code> be <a href="http://tc39.github.io/ecma262/#sec-tointeger"><code class="highlighter-rouge">ToInteger</code></a>(<code class="highlighter-rouge">v</code>).</p>

<p>If <code class="highlighter-rouge">i</code> is negative or greater than <code class="highlighter-rouge">UINT32_MAX</code>, 
<a href="https://tc39.github.io/ecma262/#sec-native-error-types-used-in-this-standard-rangeerror"><code class="highlighter-rouge">RangeError</code></a>
is thrown.</p>

<p>Return <code class="highlighter-rouge">i</code>.</p>

<h2 id="sample-api-usage">Sample API Usage</h2>

<p>Given <code class="highlighter-rouge">demo.was</code> (encoded to <code class="highlighter-rouge">demo.wasm</code>):</p>

<pre><code class="language-lisp">(module
    (import "js" "import1" (func $i1))
    (import "js" "import2" (func $i2))
    (func $main (call $i1))
    (start $main)
    (func (export "f") (call $i2))
)
</code></pre>

<p>and the following JavaScript, run in a browser:</p>

<div class="language-javascript highlighter-rouge">
<pre class="highlight"><code><span class="kd">var</span> <span class="nx">importObj</span> <span class="o">=</span> <span class="p">{</span><span class="na">js</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">import1</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"hello,"</span><span class="p">),</span>
    <span class="na">import2</span><span class="p">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"world!"</span><span class="p">)</span>
<span class="p">}};</span>
<span class="nx">fetch</span><span class="p">(</span><span class="s1">'demo.wasm'</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span>
    <span class="nx">response</span><span class="p">.</span><span class="nx">arrayBuffer</span><span class="p">()</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">buffer</span> <span class="o">=&gt;</span>
    <span class="nx">WebAssembly</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">(</span><span class="nx">buffer</span><span class="p">,</span> <span class="nx">importObj</span><span class="p">)</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(({</span><span class="nx">module</span><span class="p">,</span> <span class="nx">instance</span><span class="p">})</span> <span class="o">=&gt;</span>
    <span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">f</span><span class="p">()</span>
<span class="p">);</span>
</code></pre>
</div>


      </div>
      <div class="col-xs-12 col-lg-3">
        <h6 class="side-title">文档</h6>
        <nav class="side-nav">
        
        
        <a class="side-nav-item" href="/docs/js/">JavaScript API</a>
        
        <a class="side-nav-item" href="/docs/faq/">FAQ</a>
        
        <a class="side-nav-item" href="/docs/gc/">GC / DOM / Web API Integration <img class="emoji" title=":unicorn:" alt=":unicorn:" src="https://assets-cdn.github.com/images/icons/emoji/unicode/1f984.png" height="20" width="20" align="absmiddle"></a>
        
        <a class="side-nav-item" href="/docs/binary-encoding/">Binary Encoding</a>
        
        <a class="side-nav-item" href="/docs/c-and-c++/">Guide for C/C++ developers</a>
        
        <a class="side-nav-item" href="/docs/dynamic-linking/">Dynamic linking</a>
        
        <a class="side-nav-item" href="/docs/feature-test/">Feature Test</a>
        
        <a class="side-nav-item" href="/docs/future-features/">Features to add after the MVP</a>
        
        <a class="side-nav-item" href="/docs/high-level-goals/">WebAssembly High-Level Goals</a>
        
        <a class="side-nav-item" href="/docs/jit-library/">JIT and Optimization Library</a>
        
        <a class="side-nav-item" href="/docs/mvp/">Minimum Viable Product</a>
        
        <a class="side-nav-item" href="/docs/modules/">Modules</a>
        
        <a class="side-nav-item" href="/docs/non-web/">Non-Web Embeddings</a>
        
        <a class="side-nav-item" href="/docs/nondeterminism/">Nondeterminism in WebAssembly</a>
        
        <a class="side-nav-item" href="/docs/portability/">Portability</a>
        
        <a class="side-nav-item" href="/docs/rationale/">Design Rationale</a>
        
        <a class="side-nav-item" href="/docs/security/">Security</a>
        
        <a class="side-nav-item" href="/docs/semantics/">Semantics</a>
        
        <a class="side-nav-item" href="/docs/text-format/">Text Format</a>
        
        <a class="side-nav-item" href="/docs/tooling/">Tooling support</a>
        
        <a class="side-nav-item" href="/docs/use-cases/">Use Cases</a>
        
        <a class="side-nav-item" href="/docs/web/">Web Embedding</a>
        
        </nav>
      </div>
    </div>
  </div>
</section>
</body>
</html>
